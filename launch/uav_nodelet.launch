<launch>

  <arg name="UAV_NAME" default="$(env UAV_NAME)"/>
  <arg name="rviz" default="false"/>

  <arg name="nodelet" default="standalone"/>
  <arg name="nodelet_manager" default=""/>
  <arg name="launch_delay" default="0"/>
  <arg name="launch_prefix" default=""/>

  <arg name="config_file" default="$(find liosam)/config/sim.yaml" />
    
  <!-- {os1_imu, mavros_imu, vio_imu, xsens_imu} -->
  <arg name="imu_type" default="mavros_imu" />

  <group ns="$(arg UAV_NAME)">
   
    <!-- Load Parameters -->
    <rosparam file="$(find liosam)/config/default.yaml" command="load" />
    <rosparam if="$(eval not arg('config_file') == '')" file="$(arg config_file)" />
    <rosparam param="uav_name" subst_value="True">$(arg UAV_NAME)</rosparam>
    <rosparam param="liosam/imuType" subst_value="True">$(arg imu_type)</rosparam>

    <!-- LIOSAM nodelets -->
    <node pkg="nodelet" type="nodelet" name="imu_preintegration" args="$(arg nodelet) liosam/ImuPreintegration $(arg nodelet_manager)" output="screen" launch-prefix="bash -c 'sleep $(arg launch_delay); $0 $@'; $(arg launch_prefix)">
    </node>

    <node pkg="nodelet" type="nodelet" name="image_projection" args="$(arg nodelet) liosam/ImageProjection $(arg nodelet_manager)" output="screen" launch-prefix="bash -c 'sleep $(arg launch_delay); $0 $@'; $(arg launch_prefix)">
    </node>

    <node pkg="nodelet" type="nodelet" name="feature_extraction" args="$(arg nodelet) liosam/FeatureExtraction $(arg nodelet_manager)" output="screen" launch-prefix="bash -c 'sleep $(arg launch_delay); $0 $@'; $(arg launch_prefix)">
    </node>

    <node pkg="nodelet" type="nodelet" name="map_optimization" args="$(arg nodelet) liosam/MapOptimization $(arg nodelet_manager)" output="screen" launch-prefix="bash -c 'sleep $(arg launch_delay); $0 $@'; $(arg launch_prefix)">
      <!-- <remap from="liosam/mapping/cloud_registered_raw" to="aloam/scan_registered" /> -->
    </node>

    <!--- Run Rviz-->
    <include if="$(arg rviz)" file="$(find liosam)/launch/include/module_rviz.launch" />

  </group>


</launch>
